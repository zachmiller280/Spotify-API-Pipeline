## Spotify Web API

We will be utilizing [Spotify's Web API](https://developer.spotify.com/documentation/web-api) to extract our listening history. Primarily, we will use the `./player/recently-played` endpoint to retrieve your most recently listened to tracks. 

To get started, we first need to create a Spotify API application. To do this we must:
1. Sign into Spotify for Developers account
1. Navigate to your [dashboard](https://developer.spotify.com/dashboard)
1. Create new application
    * Note: For `Redirect URIs` I am using: http://localhost:8888/callback  
1. Go to your new app's settings and capture your `Client ID` and `Client Secret`


Next, we need to retrieve your Spotify refresh token. Because Spotify API access tokens are only valid for 1 hour, each time we run this function, we will need to generate a fresh access token using our refresh token. We will store this refresh token and then used each time our Lambda function is ran.

By using our app's Redirect URI, Client ID, and Client Secret, we can retrieve our `Spotify Refresh Token`. There are a variety of methods to retrieve your refresh token, but I have gone ahead and included a Python script that should simplify this process.

> You can find this script here: [instructions/code_snippets/get_spotify_refresh_token.py](./code_snippets/get_spotify_refresh_token.py)


## Understanding Our Data

The `listening_history` table stores information about each track the user has listened to on Spotify, including playback details and track metadata. 
For more information, refer to: Spotify's [recently-played](https://developer.spotify.com/documentation/web-api/reference/get-recently-played)
API page.


| Column Name |   Data Type  |                                                                                                                                                                                                                                                                                                                                                                                   Description                                                                                                                                                                                                                                                                                                                                                                                   |
|:-----------:|:------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
| id          | SERIAL PRIMARY KEY       | Unique identifier for each listening history record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| track_uri   | VARCHAR(255) | The unique URI for the track, used as an identifier within Spotify. Example: “spotify:track:6rqhFgbbKwnb9MLmUQDhG6”                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| track_name  | VARCHAR(255) | The name of the track.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| artist_name | VARCHAR(255) | The name of the track's main artist.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| album_name  | VARCHAR(255) | The name of the album the track is part of.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| played_at   | TIMESTAMP UNIQUE    | The date and time when the track was played; each timestamp is unique to avoid duplicates. <br> **Note: This timestamp is recorded in UTC**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ms_played   | INT          | The total milliseconds the track was played, representing playback duration.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| popularity  | INT          | The popularity of the track. The value will be between 0 and 100, with 100 being the most popular. The popularity of a track is a value between 0 and 100, with 100 being the most popular. The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are. Generally speaking, songs that are being played a lot now will have a higher popularity than songs that were played a lot in the past. Duplicate tracks (e.g. the same track from a single and an album) are rated independently. Artist and album popularity is derived mathematically from track popularity.  Note: the popularity value may lag actual popularity by a few days: the value is not updated in real time. |

### Table of Contents
0. [Project Overview](https://github.com/zachmiller280/Spotify-API-Pipeline/tree/main)
1. [Spotify API Configuration](1-spotify_api.md)
1. [AWS Account & AWS CLI Setup](2-aws.md)
1. [AWS Infrastructure with Terraform](3-aws_infrastructure.md)
1. [Dashboarding](4-google_looker.md)
1. [Insert Spotify Extended Listening History](5-spotify_extended_listening.md)
